"use strict";var app=angular.module("app",["ui.router","ngResource","ngTouch","app.user","app.menu","app.popupPage"]);app.config(function(e,t,i){e.state("index",{url:"/"}).state("search",{url:"/search/"}).state("cabinet",{url:"/cabinet/",templateUrl:"content-pages/cabinet.html"}).state("catalog",{url:"/catalog/",templateUrl:"content-pages/catalog.html"}).state("collections",{url:"/collections/",templateUrl:"content-pages/collections.html"}),t.html5Mode(!0),i.defaults.stripTrailingSlashes=!1}),angular.module("app").run(["$templateCache",function(e){e.put("header.html",'<div class="s-header-button s-header-button-menu" ng-click="menu.toggleState()" ng-class="{active: menu.getState()}"><i class="s-icon s-icon-menu"></i></div>\n<!--<div class="s-header-logo"><i class="s-icon s-icon-huge s-icon-logo"></i></div>-->\n<div class="s-header-right-buttons">\n    <div class="s-header-button s-header-button-user" ng-click="user.showUser()" user-button><i class="s-icon s-icon-user" ng-class="{authenticated: user.isAuthenticated()}"></i></div>\n</div>'),e.put("menu.html",'<div class="s-menu-inner-wrapper">\n    <ul class="s-menu-list">\n\n        <li class="s-menu-list-item" ui-sref-active="active">\n            <div class="s-menu-list-item-head" ng-click="menu.toggleItemState($event)">\n                <a class="s-menu-list-item-head-link" ui-sref="search">\n                    <span class="s-menu-list-item-head-link-icon"><i class="s-icon s-icon-search"></i></span>\n                    <span class="s-menu-list-item-head-link-label">Поиск</span>\n                </a>\n            </div>\n            <div class="s-menu-list-item-body" menu-item-search></div>\n        </li>\n\n        <li class="s-menu-list-item" ui-sref-active="active">\n            <div class="s-menu-list-item-head" ng-click="menu.toggleItemState($event)">\n                <a class="s-menu-list-item-head-link" ui-sref="cabinet">\n                    <span class="s-menu-list-item-head-link-icon"><i class="s-icon s-icon-cabinet"></i></span>\n                    <span class="s-menu-list-item-head-link-label">Кабинет</span>\n                </a>\n            </div>\n            <div class="s-menu-list-item-body" menu-item-cabinet></div>\n        </li>\n\n        <li class="s-menu-list-item" ui-sref-active="active">\n            <div class="s-menu-list-item-head" ng-click="menu.toggleItemState($event)">\n                <a class="s-menu-list-item-head-link" ui-sref="catalog">\n                    <span class="s-menu-list-item-head-link-icon"><i class="s-icon s-icon-catalog"></i></span>\n                    <span class="s-menu-list-item-head-link-label">Каталог</span>\n                </a>\n            </div>\n            <div class="s-menu-list-item-body" menu-item-catalog></div>\n        </li>\n\n        <li class="s-menu-list-item" ui-sref-active="active">\n            <div class="s-menu-list-item-head" ng-click="menu.toggleItemState($event)">\n                <a class="s-menu-list-item-head-link" ui-sref="collections">\n                    <span class="s-menu-list-item-head-link-icon"><i class="s-icon s-icon-collections"></i></span>\n                    <span class="s-menu-list-item-head-link-label">Коллекции</span>\n                </a>\n            </div>\n            <div class="s-menu-list-item-body" menu-item-collections></div>\n        </li>\n\n    </ul>\n</div>'),e.put("content-pages/cabinet.html","<h1>Cabinet</h1>\n"),e.put("content-pages/catalog.html","<h1>Catalog</h1>"),e.put("content-pages/collections.html",'<!DOCTYPE html>\n<html>\n<head lang="en">\n    <meta charset="UTF-8">\n    <title></title>\n</head>\n<body>\n\n</body>\n</html>'),e.put("popup-pages/auth.html",'<div class="s-popup-auth">\n    <form ng-submit="user.auth.submit()">\n        <div class="s-popup-auth-message" ng-class="user.auth.message.type" ng-bind="user.auth.message.value"></div>\n        <input type="email" name="email" placeholder="Email" required ng-model="user.email">\n        <input type="password" name="password" placeholder="Password" required ng-model="user.password" ng-disabled="user.auth.isRecovery()">\n        <button>Отправить</button>\n        <div class="s-popup-auth-links">\n            <a class="s-popup-auth-links-item" ng-click="user.auth.toggleRecovery()">{{ user.auth.isRecovery() ? \'Авторизоваться\' : \'Восстановить пароль\' }}</a>\n            <a class="s-popup-auth-links-item">Соглашение</a>\n        </div>\n    </form>\n</div>\n'),e.put("popup-pages/header.html",'<span ng-bind="popupPage.child.name"></span>\n<div class="s-popup-page-head-button s-popup-page-head-button-close" ng-click="popupPage.deactivateState()"><i class="s-icon s-icon-big s-icon-close"></i></div>'),e.put("popup-pages/profile.html",'<div class="s-popup-profile"></div>')}]),app.controller("WindowSizeCtrl",["$scope","$window",function(e,t){e.windowSize={width:null,height:null,isDesktopWidth:function(){return this.width>1024},saveSize:function(){e.windowSize.width=t.innerWidth,e.windowSize.height=t.innerHeight}}}]).controller("MainStateCtrl",["$scope",function(e){e.mainState={el:null,initEl:function(e){this.el=e}}}]).controller("HeaderCtrl",["$scope",function(e){e.header={}}]),app.directive("resize",["$window",function(e){return{restrict:"A",controller:"WindowSizeCtrl",link:function(t){var i=t.windowSize;i.saveSize(),angular.element(e).on("resize",i.saveSize)}}}]).directive("preload",["$window",function(){return{restrict:"A",link:function(e,t){e.$watch("$viewContentLoaded",function(){t.removeClass("preload")})}}}]).directive("mainState",function(){return{restrict:"A",controller:"MainStateCtrl",link:function(e,t){var i=e.mainState,n=e.windowSize,s="desktop-menu-active",a="mobile-menu-active";i.view={toggleMenu:function(){n.isDesktopWidth()?e.menu.state.desktopActive?t.addClass(s):t.removeClass(s):e.menu.state.mobileActive?t.addClass(a):t.removeClass(a)}},i.initEl(t),setTimeout(function(){e.$watch(e.menu.getStateAsString,function(){i.view.toggleMenu()})},0)}}}).directive("headerView",function(){return{restrict:"A",templateUrl:"header.html",controller:"HeaderCtrl"}}),app.menu=angular.module("app.menu",["ui.router"]),app.user=angular.module("app.user",[]),app.popupPage=angular.module("app.popupPage",[]),app.menu.controller("MenuCtrl",["$scope","$state",function(e,t){e.menu={el:null,state:{desktopActive:!0,mobileActive:!1},item:{el:null,activeState:null},initEl:function(e){this.el=e},getState:function(){return e.windowSize.isDesktopWidth()?this.state.desktopActive:this.state.mobileActive},getStateAsString:function(){return JSON.stringify(e.menu.state)},toggleState:function(){e.windowSize.isDesktopWidth()?this.state.desktopActive=!this.state.desktopActive:this.state.mobileActive=!this.state.mobileActive},setItemEl:function(e){this.item.el=angular.element(e.currentTarget).parent()},setItemState:function(){this.item.activeState=!t.is("index")},getItemState:function(){return e.menu.item.activeState?"expanded":"collapsed"},toggleItemState:function(e){this.item.activeState=!this.item.activeState,this.setItemEl(e)}}}]),app.menu.directive("menuView",["$window",function(){return{restrict:"A",templateUrl:"menu.html",controller:"MenuCtrl",link:function(e,t){var i=e.menu;i.view={toggleMenuItem:function(){i.item&&i.item.el&&(i.item.activeState?i.item.el.addClass("active"):i.item.el.removeClass("active"))}},i.initEl(t),setTimeout(function(){i.setItemState(),e.$watch(i.getItemState,function(){i.view.toggleMenuItem()})},0)}}}]).directive("menuItemSearch",function(){return{restrict:"A",controller:""}}).directive("menuItemCabinet",function(){return{restrict:"A",controller:""}}).directive("menuItemCatalog",function(){return{restrict:"A",controller:""}}).directive("menuItemCollections",function(){return{restrict:"A",controller:""}}),app.popupPage.controller("PopupPageCtrl",["$scope",function(e){e.popupPage={el:null,activeState:!1,child:null,initEl:function(e){this.el=e},isActiveState:function(){return this.activeState},activateState:function(){this.activeState=!0},deactivateState:function(){this.activeState=!1,this.child.deactivateState()},toggleState:function(){this.activeState?this.deactivateState():this.activateState()},getState:function(){return e.popupPage.activeState?"visible":"hidden"},setChild:function(e){this.child=e}}}]),app.popupPage.directive("popupPageState",function(){return{restrict:"A",controller:"PopupPageCtrl",link:function(e,t){var i=e.popupPage;i.view={animation:!1,isAnimation:function(){return this.animation},setAnimation:function(){this.animation=!0,t.addClass("animation")},showPage:function(){this.isAnimation()||this.setAnimation(),i.el.addClass("active")},hidePage:function(){i.el.removeClass("active")},togglePage:function(){i.activeState?this.showPage():this.hidePage()}},i.initEl(t),e.$watch("$viewContentLoaded",function(){setTimeout(function(){},500)}),e.$watch(i.getState,function(){i.view.togglePage()})}}}).directive("popupHeaderView",function(){return{restrict:"A",templateUrl:"popup-pages/header.html"}}),app.user.controller("UserCtrl",["$scope",function(e){e.user={authentication:!1,isAuthenticated:function(){return this.authentication},showUser:function(){this.isAuthenticated()?this.profile.toggleState():this.auth.toggleState()}}}]).controller("AuthCtrl",["$scope","Auth",function(e,t){e.user.auth={el:null,name:"Авторизация",activeState:!1,recovery:!1,parent:e.popupPage,message:{value:"",type:"default",list:{defaultMessage:{value:"",type:"default"},successResponse:{value:"Вы успешно авторизованы",type:"success"},errorResponse:{value:"Вы неверно ввели пароль",type:"error"},recoveryRequest:{value:"Вам будет выслан новый пароль",type:"warning"},successRecoveryResponse:{value:"Новый пароль выслан",type:"success"},errorRecoveryResponse:{value:"Email адрес не верен или не найден",type:"error"}},setValue:function(e){this._set(e)},clean:function(){this._set(this.list.defaultMessage)},_set:function(e){this.value=e.value,this.type=e.type}},initEl:function(e){this.el=e},isRecovery:function(){return this.recovery},toggleRecovery:function(){this.recovery=!this.recovery,this.isRecovery()?this.message.setValue(this.message.list.recoveryRequest):this.message.clean()},activateState:function(){this.activeState=!0,this.parent.isActiveState()||this.parent.activateState(),this.parent.setChild(this)},deactivateState:function(){this.activeState=!1},toggleState:function(){this.activeState?this.deactivateState():this.activateState()},getState:function(){return e.user.auth.activeState?"visible":"hidden"},submit:function(){this.isRecovery()?this._recoveryRequest():this._loginRequest()},_loginRequest:function(){t.save({email:e.user.email,password:e.user.password}).$promise.then(function(t){e.user.authentication=t.authentication,e.user.auth._loginResponse(t)})},_recoveryRequest:function(){t.update({email:e.user.email,recovery:!0}).$promise.then(function(t){e.user.auth._recoveryResponse(t)})},_loginResponse:function(){this.message.setValue(e.user.isAuthenticated()?this.message.list.successResponse:this.message.list.errorResponse),e.user.isAuthenticated()&&this.parent.deactivateState()},_recoveryResponse:function(e){this.message.setValue(e.success?this.message.list.successRecoveryResponse:this.message.list.errorRecoveryResponse)}},t.get().$promise.then(function(t){e.user.authentication=t.authentication})}]).controller("ProfileCtrl",["$scope",function(e){e.user.profile={el:null,name:"Профиль",activeState:!1,parent:e.popupPage,initEl:function(e){this.el=e},activateState:function(){this.activeState=!0,this.parent.isActiveState()||this.parent.activateState(),this.parent.setChild(this)},deactivateState:function(){this.activeState=!1},toggleState:function(){this.activeState?this.deactivateState():this.activateState()},getState:function(){return e.user.profile.activeState?"visible":"hidden"}}}]),app.user.directive("userButton",function(){return{restrict:"A",controller:"UserCtrl"}}).directive("authView",function(){return{restrict:"A",templateUrl:"popup-pages/auth.html",controller:"AuthCtrl",link:function(e,t){var i=e.user.auth;i.view={showForm:function(){i.el.addClass("active")},hideForm:function(){i.el.removeClass("active")},toggleForm:function(){i.activeState?this.showForm():this.hideForm()}},i.initEl(t),e.$watch(i.getState,function(){i.view.toggleForm()})}}}).directive("profileView",function(){return{restrict:"A",templateUrl:"popup-pages/profile.html",controller:"ProfileCtrl",link:function(e,t){var i=e.user.profile;i.view={showForm:function(){i.el.addClass("active")},hideForm:function(){i.el.removeClass("active")},toggleForm:function(){i.activeState?this.showForm():this.hideForm()}},i.initEl(t),e.$watch(i.getState,function(){i.view.toggleForm()})}}}),app.user.factory("Auth",["$resource",function(e){return e("/auth/",null,{update:{method:"PUT"}})}]);